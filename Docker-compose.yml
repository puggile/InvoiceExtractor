services:
  # Il nostro Backend .NET
  api:
    build:
      context: ./InvoiceExtractor.Api # Adatta il path se la tua struttura Ã¨ diversa
      dockerfile: Dockerfile
    container_name: invoice-extractor-api
    ports:
      - "5000:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      # Sovrascriviamo la connessione DB per usare il nome del servizio 'db'
      - ConnectionStrings__DefaultConnection=Server=db,1433;Database=InvoiceDb;User Id=sa;Password=YourStrong(!)Password;TrustServerCertificate=True;
      # Sovrascriviamo l'URL di Ollama per puntare all'host fisico
      - AiSettings__OllamaUrl=http://host.docker.internal:11434
    depends_on:
      - db
    extra_hosts:
      - "host.docker.internal:host-gateway" # Magia per far parlare Linux Docker con l'Host

  # Database SQL Server
  db:
    image: mcr.microsoft.com/mssql/server:2025-latest
    container_name: invoice-sql-server
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=YourStrong(!)Password
      - MSSQL_PID=Developer
    ports:
      - "1433:1433"
    volumes:
      - sqlvolume:/var/opt/mssql # Persistenza dati se spegni il container

volumes:
  sqlvolume: